"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[6479],{48193:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>c});var s=r(30758);const t={},i=s.createContext(t);function d(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(i.Provider,{value:n},e.children)}},76518:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>a,frontMatter:()=>d,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"usage/metrics","title":"Metrics","description":"Dkron has the ability to send metrics to Statsd for dashboards and historical reporting or provide prometheus format metrics via the api. It sends job processing metrics, golang, and serf metrics.","source":"@site/docs/usage/metrics.md","sourceDirName":"usage","slug":"/usage/metrics","permalink":"/docs/usage/metrics","draft":false,"unlisted":false,"editUrl":"https://github.com/distribworks/dkron/tree/main/website/docs/docs/usage/metrics.md","tags":[],"version":"current","frontMatter":{"title":"Metrics"},"sidebar":"tutorialSidebar","previous":{"title":"Job metadata","permalink":"/docs/usage/metatags"},"next":{"title":"Plugins","permalink":"/docs/usage/plugins/"}}');var t=r(86070),i=r(48193);const d={title:"Metrics"},c=void 0,o={},l=[{value:"Configuration",id:"configuration",level:2},{value:"Statsd",id:"statsd",level:3},{value:"Prometheus",id:"prometheus",level:3},{value:"Monitoring Dashboard Setup",id:"monitoring-dashboard-setup",level:2},{value:"Metrics Reference",id:"metrics-reference",level:2},{value:"Agent Event Metrics",id:"agent-event-metrics",level:3},{value:"Network Communication Metrics",id:"network-communication-metrics",level:3},{value:"gRPC Service Metrics",id:"grpc-service-metrics",level:3},{value:"Runtime Metrics",id:"runtime-metrics",level:3},{value:"Serf Metrics",id:"serf-metrics",level:3},{value:"Alerting on Metrics",id:"alerting-on-metrics",level:2}];function h(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Dkron has the ability to send metrics to Statsd for dashboards and historical reporting or provide prometheus format metrics via the api. It sends job processing metrics, golang, and serf metrics."}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"statsd",children:"Statsd"}),"\n",(0,t.jsx)(n.p,{children:"Add this in your yaml config file to enable statsd metrics."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'statsd-addr: "localhost:8125"\n# Or for datadog statsd\ndog-statsd-addr: "localhost:8125"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"prometheus",children:"Prometheus"}),"\n",(0,t.jsxs)(n.p,{children:["Add this to your yaml config file to enable serving prometheus metrics at the endpoint ",(0,t.jsx)(n.code,{children:"/metrics"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"enable-prometheus: true\n"})}),"\n",(0,t.jsx)(n.p,{children:"Additionally, in your Prometheus config file (prometheus.yml), add the following to link dkron metric endpoint"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'scrape_configs:\n  ... #initial configuration\n  \n  - job_name: "dkron_metrics"\n    # metrics_path defaults to \'/metrics\'\n    static_configs:\n      - targets: ["localhost:8080"]\n'})}),"\n",(0,t.jsx)(n.h2,{id:"monitoring-dashboard-setup",children:"Monitoring Dashboard Setup"}),"\n",(0,t.jsx)(n.p,{children:"Setting up a monitoring dashboard with metrics from Dkron is highly recommended for production deployments. You have several options:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Grafana + Prometheus"}),": Create dashboards with job execution success rates, execution timing trends, and system health metrics"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"DataDog"}),": Use built-in dashboard templates with the DogStatsD integration"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Custom StatsD Dashboards"}),": Configure with any StatsD-compatible visualization tool"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example Grafana dashboard panels for monitoring Dkron might include:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Job execution success rate over time"}),"\n",(0,t.jsx)(n.li,{children:"Average execution duration by job"}),"\n",(0,t.jsx)(n.li,{children:"System resource utilization"}),"\n",(0,t.jsx)(n.li,{children:"Cluster health status"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"metrics-reference",children:"Metrics Reference"}),"\n",(0,t.jsx)(n.p,{children:"Dkron emits several categories of metrics to help you monitor both the application and your job executions:"}),"\n",(0,t.jsx)(n.h3,{id:"agent-event-metrics",children:"Agent Event Metrics"}),"\n",(0,t.jsx)(n.p,{children:"These metrics track internal events within Dkron agents:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Metric"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.agent.event_received.query_execution_done"})}),(0,t.jsx)(n.td,{children:"Count of completed job execution events received by the agent"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.agent.event_received.query_run_job"})}),(0,t.jsx)(n.td,{children:"Count of job run requests received by the agent"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"network-communication-metrics",children:"Network Communication Metrics"}),"\n",(0,t.jsx)(n.p,{children:"These metrics help monitor the health of inter-node communication:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Metric"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.memberlist.gossip"})}),(0,t.jsx)(n.td,{children:"Count of gossip protocol messages exchanged"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.memberlist.probeNode"})}),(0,t.jsx)(n.td,{children:"Count of node health probe checks"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.memberlist.pushPullNode"})}),(0,t.jsx)(n.td,{children:"Count of anti-entropy sync operations"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.memberlist.tcp.accept"})}),(0,t.jsx)(n.td,{children:"Count of accepted TCP connections"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.memberlist.tcp.connect"})}),(0,t.jsx)(n.td,{children:"Count of initiated TCP connections"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.memberlist.tcp.sent"})}),(0,t.jsx)(n.td,{children:"Count and bytes of TCP packets sent"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.memberlist.udp.received"})}),(0,t.jsx)(n.td,{children:"Count and bytes of UDP packets received"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.memberlist.udp.sent"})}),(0,t.jsx)(n.td,{children:"Count and bytes of UDP packets sent"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"grpc-service-metrics",children:"gRPC Service Metrics"}),"\n",(0,t.jsx)(n.p,{children:"These metrics track the internal RPC communication:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Metric"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.grpc.call_execution_done"})}),(0,t.jsx)(n.td,{children:"Count and timing of execution completion RPC calls"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.grpc.call_get_job"})}),(0,t.jsx)(n.td,{children:"Count and timing of job retrieval RPC calls"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.grpc.execution_done"})}),(0,t.jsx)(n.td,{children:"Count of completed job executions"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.grpc.get_job"})}),(0,t.jsx)(n.td,{children:"Count of job information retrievals"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"runtime-metrics",children:"Runtime Metrics"}),"\n",(0,t.jsx)(n.p,{children:"These metrics provide insights into the Go runtime health:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Metric"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.runtime.alloc_bytes"})}),(0,t.jsx)(n.td,{children:"Current bytes allocated by the application"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.runtime.free_count"})}),(0,t.jsx)(n.td,{children:"Count of memory free operations"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.runtime.gc_pause_ns"})}),(0,t.jsx)(n.td,{children:"Duration of the last garbage collection pause in nanoseconds"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.runtime.heap_objects"})}),(0,t.jsx)(n.td,{children:"Number of objects in the heap"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.runtime.malloc_count"})}),(0,t.jsx)(n.td,{children:"Count of memory allocation operations"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.runtime.num_goroutines"})}),(0,t.jsx)(n.td,{children:"Number of goroutines currently running"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.runtime.sys_bytes"})}),(0,t.jsx)(n.td,{children:"Total bytes of memory obtained from the OS"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.runtime.total_gc_pause_ns"})}),(0,t.jsx)(n.td,{children:"Total time spent in GC pauses"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.runtime.total_gc_runs"})}),(0,t.jsx)(n.td,{children:"Total number of completed GC cycles"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"serf-metrics",children:"Serf Metrics"}),"\n",(0,t.jsx)(n.p,{children:"These metrics track the cluster membership and failure detection system:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Metric"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.serf.coordinate.adjustment_ms"})}),(0,t.jsx)(n.td,{children:"Time adjustment for coordinate system in milliseconds"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.serf.msgs.received"})}),(0,t.jsx)(n.td,{children:"Count of messages received"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.serf.msgs.sent"})}),(0,t.jsx)(n.td,{children:"Count of messages sent"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.serf.queries"})}),(0,t.jsx)(n.td,{children:"Count of queries processed"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.serf.queries.execution_done"})}),(0,t.jsx)(n.td,{children:"Count of execution completion queries"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.serf.queries.run_job"})}),(0,t.jsx)(n.td,{children:"Count of job run queries"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.serf.query_acks"})}),(0,t.jsx)(n.td,{children:"Count of query acknowledgments"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.serf.query_responses"})}),(0,t.jsx)(n.td,{children:"Count of responses to queries"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.serf.queue.Event"})}),(0,t.jsx)(n.td,{children:"Count of events in processing queue"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.serf.queue.Intent"})}),(0,t.jsx)(n.td,{children:"Count of intent messages in queue"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dkron.serf.queue.Query"})}),(0,t.jsx)(n.td,{children:"Count of queries in processing queue"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"alerting-on-metrics",children:"Alerting on Metrics"}),"\n",(0,t.jsx)(n.p,{children:"To set up effective alerting based on Dkron metrics, consider these recommendations:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Job Failure Alerts"}),": Monitor ",(0,t.jsx)(n.code,{children:"dkron.serf.queries.execution_done"})," with error status"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cluster Health"}),": Set alerts on node count changes or consistent gossip failures"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Performance Degradation"}),": Watch for increases in job execution time trends"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Resource Constraints"}),": Monitor ",(0,t.jsx)(n.code,{children:"dkron.runtime.gc_pause_ns"})," and other runtime metrics for signs of resource pressure"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"For Prometheus users, example alerting rules:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'groups:\n- name: dkron_alerts\n  rules:\n  - alert: DkronJobFailures\n    expr: increase(dkron_job_executions_failed_total[1h]) > 3\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: "Multiple job failures detected"\n      description: "There have been more than 3 job failures in the last hour"\n'})})]})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);