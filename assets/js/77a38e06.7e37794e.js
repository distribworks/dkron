"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8470],{12422:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>d});var i=s(85893),r=s(11151);const t={},l="Shell Executor",c={id:"usage/executors/shell",title:"Shell Executor",description:"The Shell executor is one of the most versatile executors in Dkron, allowing you to run any system command or script on target nodes.",source:"@site/docs/usage/executors/shell.md",sourceDirName:"usage/executors",slug:"/usage/executors/shell",permalink:"/docs/usage/executors/shell",draft:!1,unlisted:!1,editUrl:"https://github.com/distribworks/dkron/tree/main/website/docs/docs/usage/executors/shell.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"RabbitMQ Executor",permalink:"/docs/usage/executors/rabbitmq"},next:{title:"Job metadata",permalink:"/docs/usage/metatags"}},o={},d=[{value:"Overview",id:"overview",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Basic Usage Examples",id:"basic-usage-examples",level:2},{value:"Simple Command Execution",id:"simple-command-execution",level:3},{value:"Using Shell Features",id:"using-shell-features",level:3},{value:"Setting Environment Variables",id:"setting-environment-variables",level:3},{value:"Changing Working Directory",id:"changing-working-directory",level:3},{value:"Setting a Timeout",id:"setting-a-timeout",level:3},{value:"Advanced Examples",id:"advanced-examples",level:2},{value:"Running a Multi-line Script",id:"running-a-multi-line-script",level:3},{value:"Database Backup Example",id:"database-backup-example",level:3},{value:"System Health Check with Exit Code",id:"system-health-check-with-exit-code",level:3},{value:"Monitoring and Metrics",id:"monitoring-and-metrics",level:2},{value:"Exit Codes and Success/Failure",id:"exit-codes-and-successfailure",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Command Not Found",id:"command-not-found",level:3},{value:"Permission Issues",id:"permission-issues",level:3},{value:"Timeouts",id:"timeouts",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Additional Resources",id:"additional-resources",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"shell-executor",children:"Shell Executor"})}),"\n",(0,i.jsx)(n.p,{children:"The Shell executor is one of the most versatile executors in Dkron, allowing you to run any system command or script on target nodes."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The shell executor runs commands on the target node's operating system. It can:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Execute system commands"}),"\n",(0,i.jsx)(n.li,{children:"Run scripts in various languages (bash, python, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"Perform file system operations"}),"\n",(0,i.jsx)(n.li,{children:"Interact with local services and processes"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"shell"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:'When "true", runs the command in a shell environment (bash/cmd). Default: "false"'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"command"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,i.jsx)(n.td,{children:"The command or script to execute"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"env"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:'Environment variables in the format "KEY1=value1,KEY2=value2"'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cwd"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:"The working directory to run the command from"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"timeout"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:"Maximum execution time after which the job is forcefully terminated"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"basic-usage-examples",children:"Basic Usage Examples"}),"\n",(0,i.jsx)(n.h3,{id:"simple-command-execution",children:"Simple Command Execution"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "executor": "shell",\n  "executor_config": {\n    "command": "echo Hello Dkron"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"using-shell-features",children:"Using Shell Features"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "executor": "shell",\n  "executor_config": {\n    "shell": "true",\n    "command": "ps aux | grep nginx | wc -l"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"setting-environment-variables",children:"Setting Environment Variables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "executor": "shell",\n  "executor_config": {\n    "shell": "true",\n    "command": "python /scripts/process_data.py",\n    "env": "DATA_PATH=/data/incoming,LOG_LEVEL=info,API_KEY=secret123"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"changing-working-directory",children:"Changing Working Directory"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "executor": "shell",\n  "executor_config": {\n    "shell": "true",\n    "command": "./run_backup.sh",\n    "cwd": "/opt/backups"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"setting-a-timeout",children:"Setting a Timeout"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "executor": "shell",\n  "executor_config": {\n    "command": "/opt/scripts/long_running_task.sh",\n    "timeout": "1h30m"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"advanced-examples",children:"Advanced Examples"}),"\n",(0,i.jsx)(n.h3,{id:"running-a-multi-line-script",children:"Running a Multi-line Script"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "executor": "shell",\n  "executor_config": {\n    "shell": "true",\n    "command": "#!/bin/bash\\necho \'Starting job\'\\ncd /tmp\\ndate > last_run.txt\\necho \'Job completed\'"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"database-backup-example",children:"Database Backup Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "executor": "shell",\n  "executor_config": {\n    "shell": "true",\n    "command": "pg_dump -U postgres -d mydb | gzip > /backups/mydb_$(date +%Y%m%d_%H%M%S).sql.gz",\n    "env": "PGPASSWORD=securepassword",\n    "timeout": "30m"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"system-health-check-with-exit-code",children:"System Health Check with Exit Code"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "executor": "shell",\n  "executor_config": {\n    "shell": "true",\n    "command": "if [ $(df -h | grep \'/dev/sda1\' | awk \'{print $5}\' | tr -d \'%\') -gt 90 ]; then echo \'Disk space critical\'; exit 1; else echo \'Disk space OK\'; fi"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"monitoring-and-metrics",children:"Monitoring and Metrics"}),"\n",(0,i.jsxs)(n.p,{children:["The shell executor exposes Prometheus metrics on port 9422 (configurable with ",(0,i.jsx)(n.code,{children:"SHELL_EXECUTOR_PROMETHEUS_PORT"})," environment variable):"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Metric"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Labels"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dkron_job_cpu_usage"})}),(0,i.jsx)(n.td,{children:"gauge"}),(0,i.jsx)(n.td,{children:"Current CPU usage by job"}),(0,i.jsx)(n.td,{children:"job_name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dkron_job_mem_usage_kb"})}),(0,i.jsx)(n.td,{children:"gauge"}),(0,i.jsx)(n.td,{children:"Current memory consumed by job (KB)"}),(0,i.jsx)(n.td,{children:"job_name"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"exit-codes-and-successfailure",children:"Exit Codes and Success/Failure"}),"\n",(0,i.jsx)(n.p,{children:"By default, an exit code of 0 indicates success, while any non-zero exit code indicates failure. You can customize which exit codes are considered successful in the job definition:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "success_count": "0,1,2",  // Exit codes 0, 1, and 2 will be considered successful\n  "executor": "shell",\n  "executor_config": {\n    "command": "/opt/scripts/check.sh"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,i.jsx)(n.p,{children:"The shell executor runs commands with the same permissions as the Dkron process. Consider the following security best practices:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Principle of Least Privilege"}),": Run Dkron with a dedicated user that has only the permissions required for its jobs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Avoid Sensitive Data in Commands"}),": Use environment variables for sensitive values instead of embedding them in commands"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Input Validation"}),": Validate any dynamic parts of commands, especially if they come from external sources"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Output Sanitization"}),": Be cautious when using command output, particularly if it's displayed in the UI or logs"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.p,{children:"Common issues and solutions when working with the shell executor:"}),"\n",(0,i.jsx)(n.h3,{id:"command-not-found",children:"Command Not Found"}),"\n",(0,i.jsx)(n.p,{children:'If you see "command not found" errors:'}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Verify the command is installed on the target node"}),"\n",(0,i.jsxs)(n.li,{children:["Use absolute paths to executables (e.g., ",(0,i.jsx)(n.code,{children:"/usr/bin/python"})," instead of just ",(0,i.jsx)(n.code,{children:"python"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Check if the command is in the PATH of the user running Dkron"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"permission-issues",children:"Permission Issues"}),"\n",(0,i.jsx)(n.p,{children:"If you encounter permission errors:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check if the Dkron user has the necessary permissions"}),"\n",(0,i.jsx)(n.li,{children:"Adjust file/directory permissions as needed"}),"\n",(0,i.jsxs)(n.li,{children:["Consider using ",(0,i.jsx)(n.code,{children:"sudo"})," if appropriate (requires sudo configuration)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"timeouts",children:"Timeouts"}),"\n",(0,i.jsx)(n.p,{children:"If jobs are timing out:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Adjust the ",(0,i.jsx)(n.code,{children:"timeout"})," parameter to match the expected runtime"]}),"\n",(0,i.jsx)(n.li,{children:"Optimize the command to run more efficiently"}),"\n",(0,i.jsx)(n.li,{children:"Consider breaking large jobs into smaller, chained jobs"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsx)(n.p,{children:"If environment variables aren't working:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Ensure the format is correct (",(0,i.jsx)(n.code,{children:"KEY=value,KEY2=value2"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Remember that values are passed as strings"}),"\n",(0,i.jsx)(n.li,{children:"For complex values with spaces or special characters, consider using files instead"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/usage/processors",children:"Process Output with Processors"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/usage/chaining",children:"Job Chaining for Complex Workflows"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/usage/concepts#security-considerations",children:"Security Best Practices"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>l});var i=s(67294);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);